<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      canvas {
        border: 1px solid grey;
        width: 500px;
        height: 300px;
      }
    </style>
  </head>
  <body>
    <script src="https://www.dukelearntoprogram.com/course1/common/js/image/SimpleImage.js"></script>

    <h1>green screen online</h1>

    <canvas id="yo"> </canvas>

    <canvas id="ey"> </canvas>

    <p>
      Foreground:
      <input
        type="file"
        multiple="false"
        accept="image/*"
        id="fgfile"
        onchange="loadfgimage()"
      /><br /><br />

      Background:
      <input
        type="file"
        multiple="false"
        accept="image/*"
        id="bgfile"
        onchange="loadbgimage()"
      /><br /><br />

      <input type="button" value="Create Composite" onclick="dogreenscreen()" />
      <input type="button" value="Clear Canvases" onclick="doclear()" />

      <script>
        var fgimage = null;
        var bgimage = null;
        var fgcanvas;
        var bgcanvas;
        var canvas;

        function loadfgimage() {
          var imgfile = document.getElementById("fgfile");
          fgimage = new SimpleImage(imgfile);
          fgcanvas = document.getElementById("yo");
          fgimage.drawTo(fgcanvas);
        }

        function loadbgimage() {
          var imgfile = document.getElementById("bgfile");
          bgimage = new SimpleImage(imgfile);
          bgcanvas = document.getElementById("ey");
          bgimage.drawTo(bgcanvas);
        }

        function composite() {
          var output = new SimpleImage(fgimage.getWidth(), fgimage.getHeight());
          var greenThreshold = 240;
          for (var pixel of fgimage.values()) {
            var x = pixel.getX();
            var y = pixel.getY();
            if (pixel.getGreen() > greenThreshold) {
              var bgpixel = bgimage.getPixel(x, y);
              output.setPixel(x, y, bgpixel);
            } else {
              output.setPixel(x, y, pixel);
            }
          }
        }

        function dogreenscreen() {
          if (fgimage == null || !fgimage.complete()) {
            alert("foreground not loaded");
            return;
          }
          if (bgimage == null || !bgimage.complete()) {
            alert("background not loaded");
          }
          clear();
          var finalimage = composite();
          finalimage.drawTo(fgcanvas);
        }

        function doclear() {
          fgcanvas = document.getElementById("yo");
          bgcanvas = document.getElementById("ey");
          var context1 = canvas.getContext("2d");
          var context2 = canvas.getContext("2d");
          context1.clearRect(0, 0, canvas.width, canvas.height);
          context2.clearRect(0, 0, canvas.width, canvas.height);
        }
      </script>
    </p>
  </body>
</html>
